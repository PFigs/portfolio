% TESTECEFTOENU script serves as a debug tool for the fuction xyztolla.

%   INPUT : xyz = [4910445.093380, -821633.480531, 3973410.564928]
%   OUTPUT: enu = [142.768289, 161.966841, 20.403658]

%   INPUT : xyz = [6910384.3, -321478.6, 2973549.6];
%   OUTPUT: enu = [592401.482477179, -1701426.02703467, 1415701.22486627];

%   INPUT : xyz = [775858.6194, 4903039.9874, 3991748.6190];
%   OUTPUT: enu = [2.09547579288483e-09, -6246866.5355431, 7716455.75043843];

%   INPUT : xyz = [-775858.6194, -4903039.9874, 3991748.6190];
%   OUTPUT: enu = [2.79396772384644e-09, -6246866.5355431, 7716455.75043843]; 

%   INPUT : xyz = [4910384.3, -821478.6, 3973549.6];
%   OUTPUT: enu = [-823148.928003576, 1963405.78396477, -847032.212976721];

% Pedro Silva, Instituto Superior TÃ©cnico, November 2011

clc
clear
disp('ECEF - ENU CONVERSION TESTING SCRIPT');

% OPERATION MODE
mode = 'ECEF';

% EVALUATION POINTS
xyz = [
        4910445.093380, -821633.480531, 3973410.564928;
        4910384.3  , -821478.6    , 3973549.6;
       -775858.6194, -4903039.9874, 3991748.6190;
       775858.6194 , 4903039.9874 , 3991748.6190;
        6910384.3  , -321478.6    , 2973549.6
       ];

% REFERENCE POINTS
refxyz = [
            4910384.27903237, -821478.554292114, 3973549.60386728;
            6910384.3  , -321478.6    , 2973549.6;
            775858.6194 , 4903039.9874 , 3991748.6190;
            -775858.6194, -4903039.9874, 3991748.6190;
            4910384.3  , -821478.6    , 3973549.6
         ];

% SWITCH REFXYZ TO DESIRABLE UNIT
%    DEFAULT : REFXYZ is given in ECEF
tic
if strcmpi(mode,'deg')
    refxyz = eceftolla(refxyz);     % REFXYZ in DEG
elseif strcmpi(mode,'rad')
    refxyz = eceftolla(refxyz,'rad'); % REFXYZ in RAD
end
toc
% USER SOLUTION
tic
enu = eceftoenu(xyz,refxyz);
%enu = eceftoenu(xyz,[0 0 0]);
toc

disp('ENU SOLUTION');
disp(xyz);
disp(enu);

%elv = elevation(enu);


%% INFORMATION FOR FURTHER DEBUG
% ###
% refwgs = [4.91852666799999959767e+06	-7.91212114999999990687e+05	3.96976714000000013039e+06];
% satwgs = [1.74700617555049173534e+07	5.28011251006891019642e+06	1.94756219402517005801e+07];
% vec = [1.25515350875049177557e+07	6.07132462506891041994e+06	1.55058548002516999841e+07];
% evec = [7.98772079011547099799e+06	4.94375489941079821438e+06	1.86169050305369682610e+07];
% 
% 
% ###
% refwgs = [4.91852666799999959767e+06	-7.91212114999999990687e+05	3.96976714000000013039e+06];
% satwgs = [1.00813050573578476906e+07	-1.13582371625087596476e+07	2.18981933298018351197e+07];
% vec = [5.16277838935784809291e+06	-1.05670250475087594241e+07	1.79284261898018345237e+07];
% evec = [-9.61293855725324526429e+06	9.74469703943292424083e+06	1.65038497508796826005e+07];
% 
% 
% ###
% refwgs = [4.91852666799999959767e+06	-7.91212114999999990687e+05	3.96976714000000013039e+06];
% satwgs = [1.97086179121760725975e+07	-1.71128726131502911448e+07	4.39095366614156309515e+06];
% vec = [1.47900912441760729998e+07	-1.63216604981502909213e+07	4.21186526141562964767e+05];
% evec = [-1.37655043486793302000e+07	-1.04310823270613700151e+07	1.36756795089053958654e+07];
% 
% 
% ###
% refwgs = [4.91852666799999959767e+06	-7.91212114999999990687e+05	3.96976714000000013039e+06];
% satwgs = [2.01285328777234964073e+07	1.56500903436940927058e+07	-7.21415914758440852165e+06];
% vec = [1.52100062097234968096e+07	1.64413024586940929294e+07	-1.11839262875844091177e+07];
% evec = [1.86482984550639018416e+07	-1.64866202323114518076e+07	2.67829062848102767020e+06];
% 
% 
% ###
% refwgs = [4.91852666799999959767e+06	-7.91212114999999990687e+05	3.96976714000000013039e+06];
% satwgs = [1.93061024833919033408e+07	-1.72067514065884500742e+07	-5.75002243189293518662e+06];
% vec = [1.43875758153919037431e+07	-1.64155392915884498507e+07	-9.71978957189293578267e+06];
% evec = [-1.39221198045876324177e+07	-1.81018898136804997921e+07	7.03155336460528615862e+06];
% 
% 
% ###
% refwgs = [4.91852666799999959767e+06	-7.91212114999999990687e+05	3.96976714000000013039e+06];
% satwgs = [1.47692730879193879664e+07	2.40637180381908034906e+06	2.18955100216921083629e+07];
% vec = [9.85074641991938836873e+06	3.19758391881908010691e+06	1.79257428816921077669e+07];
% evec = [4.72151150157421082258e+06	8.21429361486356891692e+06	1.84072462730657868087e+07];
% 
% 
% ###
% refwgs = [4.91852666799999959767e+06	-7.91212114999999990687e+05	3.96976714000000013039e+06];
% satwgs = [2.30733500358316302299e+07	-6.47568713131111487746e+06	1.13376756267840340734e+07];
% vec = [1.81548233678316324949e+07	-5.68447501631111465394e+06	7.36790848678403347731e+06];
% evec = [-2.72894096013173926622e+06	-6.03411822360867541283e+06	1.92960939492293037474e+07];
% 
% 
% ###
% refwgs = [4.91852666799999959767e+06	-7.91212114999999990687e+05	3.96976714000000013039e+06];
% satwgs = [2.49564956398481652141e+07	9.35443956564294174314e+06	-1.43206155229193833657e+06];
% vec = [2.00379689718481674790e+07	1.01456516806429419667e+07	-5.40182869229193869978e+06];
% evec = [1.31993426830276511610e+07	-1.55849353280479758978e+07	1.07945053299870006740e+07];
% 
% 
% ###
% refwgs = [4.91852666799999959767e+06	-7.91212114999999990687e+05	3.96976714000000013039e+06];
% satwgs = [-4.17023306784288724884e+06	-1.74173051167326234281e+07	1.99118320246712230146e+07];
% vec = [-9.08875973584288731217e+06	-1.66260930017326232046e+07	1.59420648846712224185e+07];
% evec = [-1.78585558607074059546e+07	1.63979095101057998836e+07	5.03611964647222589701e+06];
% 
% 
% ###
% refwgs = [4.91852666799999959767e+06	-7.91212114999999990687e+05	3.96976714000000013039e+06];
% satwgs = [2.29288943052650168538e+07	-2.69125347965204215143e+05	-1.37345432780661750585e+07];
% vec = [1.80103676372650191188e+07	5.22086767034795775544e+05	-1.77043104180661737919e+07];
% evec = [3.37589981338802073151e+06	-2.48848546351502649486e+07	2.72687268467186391354e+06];