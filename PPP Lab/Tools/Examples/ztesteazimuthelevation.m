% TESTECEFTOENU script serves as a debug tool for the fuction xyztolla.

%   INPUT : xyz = [4910445.093380, -821633.480531, 3973410.564928]
%   OUTPUT: enu = [142.768289, 161.966841, 20.403658]

%   INPUT : xyz = [6910384.3, -321478.6, 2973549.6];
%   OUTPUT: enu = [592401.482477179, -1701426.02703467, 1415701.22486627];

%   INPUT : xyz = [775858.6194, 4903039.9874, 3991748.6190];
%   OUTPUT: enu = [2.09547579288483e-09, -6246866.5355431, 7716455.75043843];

%   INPUT : xyz = [-775858.6194, -4903039.9874, 3991748.6190];
%   OUTPUT: enu = [2.79396772384644e-09, -6246866.5355431, 7716455.75043843]; 

%   INPUT : xyz = [4910384.3, -821478.6, 3973549.6];
%   OUTPUT: enu = [-823148.928003576, 1963405.78396477, -847032.212976721];

% Pedro Silva, Instituto Superior TÃ©cnico, November 2011

clc
clear

disp('ENU CONVERSION TESTING SCRIPT');

% OPERATION MODE
mode = 'ECEF';

% EVALUATION POINTS
% xyz = [
%         4910445.093380, -821633.480531, 3973410.564928;
%         4910384.3  , -821478.6    , 3973549.6;
%        -775858.6194, -4903039.9874, 3991748.6190;
%        775858.6194 , 4903039.9874 , 3991748.6190;
%         6910384.3  , -321478.6    , 2973549.6
%        ];
xyz = [17470061.756, 5280112.510, 19475621.940;
       10081305.057, -11358237.163, 21898193.330;
       19708617.912, -17112872.613, 4390953.666;
       20128532.878, 15650090.344, -7214159.148;
       19306102.483, -17206751.407, -5750022.432;
       14769273.088, 2406371.804, 21895510.022;
       23073350.036, -6475687.131, 11337675.627;
       24956495.640, 9354439.566, -1432061.552;
       -4170233.068, -17417305.117, 19911832.025;
       22928894.305, -269125.348, -13734543.278];
   
   
% REFERENCE POINTS
% refxyz = [
%             4910384.27903237, -821478.554292114, 3973549.60386728;
%             6910384.3  , -321478.6    , 2973549.6;
%             775858.6194 , 4903039.9874 , 3991748.6190;
%             -775858.6194, -4903039.9874, 3991748.6190;
%             4910384.3  , -821478.6    , 3973549.6
%          ];

refxyz=[4918526.668,       -791212.115,       3969767.14];



% SWITCH REFXYZ TO DESIRABLE UNIT
%    DEFAULT : REFXYZ is given in ECEF
if strcmpi(mode,'deg')
    refxyz = eceftolla(refxyz);     % REFXYZ in DEG
elseif strcmpi(mode,'rad')
    refxyz = eceftolla(refxyz,'rad'); % REFXYZ in RAD
end
enu = eceftoenu(xyz,refxyz,mode);

% DEFAULT IS DEGREE
disp('AZIMUTH AND ELEVATION');
az = azimuth(enu,'deg');
el = elevation(enu,'deg');

for i=1:size(el,1)
    fprintf('AZ: %4.1f ELEV: %04.1f\n',az(i),el(i));
end
%%
wgs     = [0.601915216522144, 0.291153444642207, 0.743591113308973];
enu     = [0.383055192482957, 0.237080267868876, 0.89278310137405];
satwgs  = [17470061.7555049,  5280112.51006891,  19475621.9402517];
userwgs = [4918526.668,       -791212.115,       3969767.14];

[dc,ec] = directorcos( refxyz, xyz, 'enu' );
az = azimuth(enu,'deg');
el = elevation(enu,'deg');

for i=1:size(el,1)
    fprintf('2.AZ: %4.1f ELEV: %04.1f\n',az(i),el(i));
end


% wgs     = [0.601915216522144, 0.291153444642207, 0.743591113308973];
% enu     = [0.383055192482957, 0.237080267868876, 0.89278310137405];
% satwgs  = [17470061.7555049,  5280112.51006891,  19475621.9402517];
% userwgs = [4918526.668,       -791212.115,       3969767.14];

% for each entry [ dcwgs, dcenu ] = dcosine( userwgs, satwgs )
% evec =
% 
%           7987720.79011547           4943754.8994108           18616905.030537

% vec =
% 
%           12551535.0875049          6071324.62506891          15505854.8002517
